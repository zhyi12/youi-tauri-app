<script lang="ts">

    import {afterNavigate} from "$app/navigation";
    import {Toolbar,Button,Icon,saveIcon} from "$lib/youi";
    import {isEqual} from "lodash";
    import {treeStore} from "$lib/app-stores/{{module_name}}/{{name}}Store";

    export let data;

    /**
     * 原始数据
     */
    let orgRecord = undefined;
    /**
     * 监听数据变化
     */
    $: dirty = !isEqual(orgRecord,data.record);
    /**
     * 保存数据
     */
    const doSave = async () => {
        // 未变化直接返回
        if(!dirty)return;
        // 数据校验
        await treeStore.update(data.record);
    }

    afterNavigate(()=>{
        orgRecord = {...data.record};
    });

</script>

<Toolbar>
    <Button class="btn-ghost btn-xs" disabled={!dirty} title="保存" on:click={()=>doSave()}>
        <Icon data={saveIcon}/>
    </Button>
</Toolbar>
<div class="p-1 flex-1">
{% for property in properties %}
    <label class="input input-sm input-bordered flex items-center gap-2 mb-2">
        {{ property.caption }}：
        <input type="text" class="grow" bind:value={data.record.{{ property.name }}} placeholder="请输入{{ property.caption }}"/>
    </label>{% endfor %}
</div>
